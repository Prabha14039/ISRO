# ======================
#	Path/Variables
# ======================

LIBTORCH=/Volumes/Windows/ISRO/CNN/libtorch/
python_lun=/opt/homebrew/Caskroom/miniforge/base/envs/lunar_env/bin/python3
python_isis=/opt/homebrew/Caskroom/miniforge/base/envs/isis/bin/python3


# ======================
# DEM + NAC Processing Pipeline
# ======================

.PHONY: all help encoders decoders fusion train inference main

# üîÅ Full pipeline
all: encoders decoders fusion train inference main

# üìò Help menu
help:
	@echo ""
	@echo "üõ†Ô∏è  Short Make Targets:"
	@echo "  make all     ‚û§ Run the full DEM processing pipeline"
	@echo "  make lola    ‚û§ Convert LOLA IMG+LBL to .cub"
	@echo "  make scale   ‚û§ Scale, resample, and blur the DEM"
	@echo "  make cubs    ‚û§ Convert NAC .IMG to .cub and initialize SPICE"
	@echo "  make json    ‚û§ Generate ISD .json files from .cub"
	@echo "  make maps    ‚û§ Mapproject each .cub file to GeoTIFF"
	@echo "  make lists   ‚û§ Generate image/camera/map lists for bundle adjustment"
	@echo "  make ba      ‚û§ Run parallel bundle adjustment"
	@echo "  make clean   ‚û§ Clean temporary logs and intermediate files"
	@echo ""

# üéØ Individual stages
lola:
	bash scripts/convert_lola_dem.sh

scale:
	bash scripts/scale_resample_blur.sh

box:
	bash scripts/batch_crop_sldem.sh

# üßπ Clean local temp artifacts
clean:
	@echo "üßπ Cleaning temporary files..."
	@rm -f default.profraw print.prt

cpp: #Todolist
	@echo "Moving to build Directory"
	@cd build && cmake -DCMAKE_PREFIX_PATH=$(LIBTORCH) .. && cmake --build . --config Release

encoders:
	@$(python_isis) src/encoder.py

fusion:
	@$(python_isis) src/fusion.py

decoders:
	@$(python_isis) src/decoder.py

train:
	@$(python_isis) src/trainning.py

inference:
	@$(python_isis) src/inference.py

main:
	@$(python_isis) src/main.py
